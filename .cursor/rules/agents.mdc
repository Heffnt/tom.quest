---
description: Project context for TOM.quest - UPDATE THIS FILE after any changes or fixes
alwaysApply: true
---

# TOM.quest

**AGENT REQUIREMENT: After ANY code change, add/update relevant info here. After ANY bug fix, add to Fixes section. This prevents repeated mistakes and keeps context accurate.**

## Stack
Next.js 16 (App Router) | TypeScript | Tailwind v4 (PostCSS) | Geist fonts | Vercel

## Design
- Colors: black bg, white text (60%/40% opacity for secondary)
- Layout: max-w-3xl mx-auto, px-6 py-16, min-h-screen
- Animations: animate-fade-in, animate-fade-in-delay (globals.css)

## Structure
```
app/                      # Next.js frontend
├── turing/page.tsx       # GPU dashboard (client component)
├── api/turing/           # Proxy routes → Turing backend
│   ├── gpu-report/       # GET gpu availability
│   ├── allocate/         # POST allocation request
│   ├── jobs/             # GET list, DELETE cancel
│   ├── dirs/             # GET directory listing
│   ├── screens/          # GET list screen sessions
│   └── ws-url/           # GET WebSocket URL + API key
├── components/
│   ├── Navigation.tsx
│   └── ScreenViewer.tsx  # WebSocket screen session viewer
└── hooks/useWebSocket.ts # WebSocket connection hook

tom-quest-api/            # FastAPI on Turing HPC
├── main.py               # + WebSocket endpoints
├── gpu_report.py, slurm.py, screens.py, dirs.py
```

## Turing Dashboard
- Proxy: frontend → /api/turing/* → TURING_API_URL (via Cloudflare tunnel)
- Auth: X-API-Key header (TURING_API_KEY on Vercel, API_KEY on Turing)
- GPUs: nvidia=H100, tesla=V100, max 12 allocations
- Allocation: --job-name=tom.quest, project_dir → cd first, then commands
- Screens: `tq_{project_name}_{index}` (reused, not per-job)
- localStorage: `turing_project_commands` = {projectDir: [{name, commands}]}
- Active Jobs: manual refresh + auto-refresh toggle (30s)

## Debug Terminal (bottom panel)
- API Logs tab: logs all REST API requests/responses with timing
- Turing Shell tab: WebSocket PTY bash on Turing HPC
- Screen Sessions section: below Active Jobs, one viewer per screen
- WebSocket endpoints (backend):
  - `/ws/shell?api_key=...` - interactive PTY bash
  - `/ws/screens/{name}?api_key=...` - screen session output + command input
- Frontend gets WS URL via `/api/turing/ws-url` endpoint

## Fixes & Lessons
<!-- Add entries: [date] issue → fix -->

## Placeholders
- /projects: showcase work
- /data-labeling: annotation tools
